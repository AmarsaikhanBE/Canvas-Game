<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        
        html {
            height: 100%;
        }
        
        body {
            background: black;
            text-align: center;
        }
        
        .score {
            font-family: verdana;
            font-size: 2em;
            position: relative;
            color: #fff;
            margin-top: 3rem;
        }
        
        canvas {
            display: block;
            position: absolute;
            margin: auto;
            top: 0;
            bottom: 0;
            right: 0;
            left: 0;
        }
    </style>
</head>

<body>
    <div class="score" id="score">0</div>
    <canvas id="board" height="376" width="376"></canvas>
    <script>
        const board = document.getElementById('board');
        const ctx = board.getContext('2d');
        const scoreIs = document.getElementById('score');
        let direction = 'right';
        let directionQueue = 'right';
        let fps = 150;
        let snake = [];
        let snakeLength = 3;
        let cellSize = 15;
        let snakeColor = '#3498db';
        let foodColor = '#ff3636';
        const foodX = [];
        const foodY = [];
        const food = {
            x: 0,
            y: 0
        };
        let score = 0;
        // Хоолны кординат үүсгэх
        for (i = 0; i <= board.width - cellSize; i += cellSize) {
            foodX.push(i);
            foodY.push(i);
        }
        // Ачаалах үед canvas дээр фокуслах
        board.setAttribute('tabindex', 1);
        board.focus();
        // Дүрс зурах
        const drawSquare = (x, y, color) => {
                ctx.fillStyle = color;
                ctx.fillRect(x, y, cellSize, cellSize);
            }
            // Хоолны кординат өгөх
        const createFood = () => {
                food.x = foodX[Math.floor(Math.random() * foodX.length)];
                food.y = foodY[Math.floor(Math.random() * foodY.length)];
                // Хоолыг идсэн тохиодолд шинээр үүсгэх
                for (i = 0; i < snake.length; i++) {
                    if (checkCollision(food.x, food.y, snake[i].x, snake[i].y)) {
                        createFood();
                    }
                }
            }
            // Хоол гаргаж ирэх
        const drawFood = () => drawSquare(food.x, food.y, foodColor);
        // Тоглоомын талбайг үүсгэх
        const setBackground = () => {
                ctx.fillStyle = 'white';
                ctx.strokeStyle = '#eee';
                ctx.fillRect(0, 0, board.height, board.width);
                for (let x = 0.5; x < board.width; x += cellSize) {
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, board.height);
                };
                for (let y = 0.5; y < board.height; y += cellSize) {
                    ctx.moveTo(0, y);
                    ctx.lineTo(board.width, y);
                };
                ctx.stroke();
            }
            // Могойг үүсгэх
        const createSnake = () => {
                snake = [];
                for (let i = snakeLength; i > 0; i--) {
                    k = i * cellSize;
                    snake.push({
                        x: k,
                        y: 0
                    });
                }
            }
            // Могойг зурах
        const drawSnake = () => {
                for (let i = 0; i < snake.length; i++) {
                    drawSquare(snake[i].x, snake[i].y, snakeColor);
                }
            }
            // Могойн хөдөлгөөний чиглэлийг удирдах
        const changeDirection = (keycode) => {
            if (keycode == 37 && direction != 'right') {
                directionQueue = 'left';
            } else if (keycode == 38 && direction != 'down') {
                directionQueue = 'up';
            } else if (keycode == 39 && direction != 'left') {
                directionQueue = 'right';
            } else if (keycode == 40 && direction != 'up') {
                directionQueue = 'down';
            };
        };
        // Могойг хөдөлгөх
        const moveSnake = () => {
            let x = snake[0].x;
            let y = snake[0].y;
            direction = directionQueue;
            direction == 'left' ? x -= cellSize : direction == 'up' ? y -= cellSize : direction == 'right' ? x += cellSize : y += cellSize;
            // Могойн сүүлийг 1 нүдээр хасаад шинэ толгойг 1 нүдээр чиглэлийн дагуу нэмэгдүүлэх
            const tail = snake.pop();
            tail.x = x;
            tail.y = y;
            snake.unshift(tail);
        };
        // Кординатуудын давхцалыг шалгах
        const checkCollision = (x1, y1, x2, y2) => x1 == x2 && y1 == y2;
        // main game loop
        const game = () => {
            // var head = snake[0];
            // Могой хана мөргөсөн эсэхийг шалгах
            /*// Тоглоом дуусах
            if (head.x < 0 || head.x > board.width - cellSize || head.y < 0 || head.y > board.height - cellSize) {
                alert('Game Over!');
                setBackground();
                createSnake();
                drawSnake();
                createFood();
                drawFood();
                directionQueue = 'right';
                score = 0;
            }*/
            // Талбайн эсрэг талаас гарч ирэх
            snake[0].x < 0 && direction == 'left' ? snake[0].x = board.width - cellSize - 1 : snake[0].x > board.width - cellSize && direction == 'right' ? snake[0].x = 0 : snake[0].y < 0 && direction == 'up' ? snake[0].y = board.height - cellSize - 1 : snake[0].y > board.height - cellSize && direction == 'down' ? snake[0].y = 0 : score = score;
            // Могой биеэ мөргөсөн эсэхийг шалгах
            for (i = 1; i < snake.length; i++) {
                if (snake[0].x == snake[i].x && snake[0].y == snake[i].y) {
                    alert('Game Over!');
                    setBackground();
                    createSnake();
                    drawSnake();
                    createFood();
                    drawFood();
                    directionQueue = 'right';
                    score = 0;
                    fps = 150;
                }
            }
            // Могой хоолыг идсэн эсэхийг шалгах
            if (checkCollision(snake[0].x, snake[0].y, food.x, food.y)) {
                snake[snake.length] = {
                    x: snake[0].x,
                    y: snake[0].y
                };
                createFood();
                drawFood();
                score += 10;
                fps -= 5;
                clearInterval(loop);
                loop = setInterval(game, fps);
            }
            board.onkeydown = event => {
                event = event || window.event;
                changeDirection(event.keyCode);
            };
            ctx.beginPath();
            setBackground();
            scoreIs.innerHTML = score;
            drawSnake();
            drawFood();
            moveSnake();
        }

        const newGame = () => {
            ctx.beginPath();
            createSnake();
            createFood();
            typeof loop != 'undefined' ? clearInterval(loop) : loop = setInterval(game, fps);
        }
        newGame();
    </script>
</body>

</html>